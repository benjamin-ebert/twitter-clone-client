<div *ngIf="profile$ | async as profile; else loadingProfile">
  <!-- Info Area -->
  <div class="relative">
    <div class="h-32 md:h-52">
      <img *ngIf="profile.header; else headerPlaceholder" alt="user header" class="object-cover h-full w-full"
           src="{{ env.userImgDir }}/{{ profile.id }}/{{ profile.header }}">
      <ng-template #headerPlaceholder>
        <div class="h-full w-full flex justify-around items-center bg-gray-300"></div>
      </ng-template>
    </div>
    <div class="h-24 w-24 md:h-36 md:w-36 absolute top-20 md:top-32 left-4">
      <img *ngIf="profile.avatar; else avatarPlaceholder" alt="user avatar"
           src="{{ env.userImgDir }}/{{ profile.id }}/{{ profile.avatar }}"
           class="object-cover h-full w-full rounded-full border-4 border-white">
      <ng-template #avatarPlaceholder>
        <div class="h-full w-full flex justify-around items-center bg-gray-200 rounded-full border-4 border-white">
          <mat-icon class="text-5xl text-gray-600" style="width: auto; height: auto">person_outline</mat-icon>
        </div>
      </ng-template>
    </div>
    <div class="mx-4 my-3">
      <div class="flex justify-end items-start">
        <button *ngIf="(authedUser$|async)!.id === profile.id; else followButton" (click)="openProfileDialog()" mat-stroked-button>
          Set up profile
        </button>
        <ng-template #followButton>
          <button *ngIf="!profile.auth_follow; else unfollowButton" (click)="followUser(profile)" mat-flat-button color="primary">Follow</button>
          <ng-template #unfollowButton>
            <button (click)="unfollowUser(profile)" mat-stroked-button matTooltip="Click to unfollow">Following</button>
          </ng-template>
        </ng-template>
      </div>
      <div class="text-gray-500 pt-4 md:pt-8">
        <div class="text-lg text-black font-bold">{{ profile.name }}</div>
        <div class="-mt-1">@{{ profile.handle }}</div>
        <div class="my-2 text-black">{{ profile.bio }}</div>
        <div class="flex items-center py-2">
          <mat-icon>calendar_today</mat-icon>
          <div class="pl-1">Joined {{ profile.created_at | date: 'MMMM YYYY' }}</div>
        </div>
        <div class="flex">
          <div class="pr-4"><span class="font-bold text-black">
            {{ profile.followed_count }}</span> Following
          </div>
          <div class="pr-4"><span class="font-bold text-black">
            {{ profile.follower_count }}
          </span> Followers</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Tweets Area -->
<!-- Prevent scrollTop when selecting lazy loading tabs with this min-height parent around the tab group. -->
<div style="min-height: 800px">
  <mat-tab-group #tabs mat-align-tabs="center" [disablePagination]="true" (selectedIndexChange)="selectedTab$.next($event)">
    <!-- The user's original Tweets -->
    <mat-tab label="Tweets">
      <ng-template matTabContent>
        <div *ngIf="originalTweets.length; else noTweets">
          <div *ngFor="let tweet of originalTweets">
            <app-tweet [tweet]="tweet"></app-tweet>
          </div>
        </div>
        <ng-template #noTweets>
          <div *ngIf="tabContentComplete; else loading" class="flex justify-around py-5">
            No tweets or retweets in here yet.
          </div>
          <ng-template #loading>
            <mat-spinner diameter="27" strokeWidth="3"></mat-spinner>
          </ng-template>
        </ng-template>
      </ng-template>
    </mat-tab>
    <!-- The user's Tweets (including those that are replies or retweets) -->
    <mat-tab label="Tweets & Replies">
      <ng-template matTabContent>
        <div *ngIf="allTweetsFiltered.length; else noTweets">
          <div *ngFor="let tweet of allTweetsFiltered">
            <app-tweet [tweet]="tweet"></app-tweet>
          </div>
        </div>
        <ng-template #noTweets>
          <div *ngIf="tabContentComplete; else loading" class="flex justify-around py-5">
            No tweets or replies in here yet.
          </div>
          <ng-template #loading>
            <mat-spinner diameter="27" strokeWidth="3"></mat-spinner>
          </ng-template>
        </ng-template>
      </ng-template>
    </mat-tab>
    <!-- The user's Tweets that contain images-->
    <mat-tab label="Media">
      <ng-template matTabContent>
        <div *ngIf="imageTweets.length; else noTweets">
          <div *ngFor="let tweet of imageTweets">
            <app-tweet [tweet]="tweet"></app-tweet>
          </div>
        </div>
        <ng-template #noTweets>
          <div *ngIf="tabContentComplete; else loading" class="flex justify-around py-5">
            No image tweets in here yet.
          </div>
          <ng-template #loading>
            <mat-spinner diameter="27" strokeWidth="3"></mat-spinner>
          </ng-template>
        </ng-template>
      </ng-template>
    </mat-tab>
    <!-- All Tweets liked by the user -->
    <mat-tab label="Likes">
      <ng-template matTabContent>
        <div *ngIf="likedTweets.length; else noTweets">
          <div *ngFor="let tweet of likedTweets">
            <app-tweet [tweet]="tweet"></app-tweet>
          </div>
        </div>
        <ng-template #noTweets>
          <div *ngIf="tabContentComplete; else loading" class="flex justify-around py-5">
            No liked tweets in here yet.
          </div>
          <ng-template #loading>
            <mat-spinner diameter="27" strokeWidth="3"></mat-spinner>
          </ng-template>
        </ng-template>
      </ng-template>
    </mat-tab>
  </mat-tab-group>
</div>
<ng-template #loadingProfile>
  <div class="flex justify-around py-5">
    <mat-spinner diameter="27" strokeWidth="3"></mat-spinner>
  </div>
</ng-template>

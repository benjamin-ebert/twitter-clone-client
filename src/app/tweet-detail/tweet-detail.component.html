<!-- Show loading spinner until the tweet is ready. -->
<ng-template #loadingTweet>
  <div class="flex justify-around py-5">
    <mat-spinner diameter="27" strokeWidth="3"></mat-spinner>
  </div>
</ng-template>

<!-- The tweet -->
<div *ngIf="tweet; else loadingTweet">
  <div class="my-3 mx-4">
    <div class="relative">
      <div class="absolute top-0 right-0">
        <mat-icon>more_horiz</mat-icon>
      </div>
      <div class="grid grid-cols-10 gap-4">
        <div class="col-span-2 md:col-span-1 flex flex-col items-center">
          <div class="h-12 w-12">
            <a routerLink="/profile/{{ tweet!.user.id }}">
              <img *ngIf="tweet!.user.avatar; else avatarPlaceholder" matListAvatar src="{{ env.userImgDir }}/{{ tweet!.user.id }}/{{ tweet!.user.avatar }}"
                   alt="user avatar" class="object-cover h-full w-full rounded-full cursor-pointer">
              <ng-template #avatarPlaceholder>
                <div class="h-full w-full flex justify-around items-center bg-gray-200 rounded-full">
                  <mat-icon class="text-gray-600" style="width: auto; height: auto">person_outline</mat-icon>
                </div>
              </ng-template>
            </a>
          </div>
        </div>
        <div class="col-span-8 md:col-span-9">
          <a routerLink="/profile/{{ tweet!.user.id }}">
            <span class="font-bold pr-2 hover:underline">{{ tweet!.user.name }}</span>
          </a>
          <div class="text-gray-500">@{{ tweet!.user.handle }}</div>
        </div>
      </div>
      <div class="py-3">
        <div class="text-xl py-2">
          {{ tweet!.content }}
          <div *ngIf="tweet!.images?.length"
               class="mt-3 flex h-80 rounded-3xl overflow-hidden"
               [ngClass]="{'flex-wrap' : tweet!.images.length === 4}">
            <img *ngFor="let img of tweet!.images" src="{{ env.serverUrl }}/{{ img.url }}"
                 alt="tweet image" class="w-full object-cover border border-transparent"
                 [ngClass]="{
                     'w-2/4' : tweet!.images.length === 2,
                     'w-1/3' : tweet!.images.length === 3,
                     'w-1/2 h-1/2' : tweet!.images.length === 4
                     }">
          </div>
        </div>
        <div class="py-4 text-gray-500">
          {{ tweet!.created_at | date:'hh:mm' }} · {{ tweet!.created_at | date }} · Twitter Clone Web App
        </div>
        <mat-divider></mat-divider>
        <div class="py-4 text-gray-500 flex items-center">
          <div class="px-2">
            <span class="text-black font-bold pr-1">{{ tweet!.retweets_count }}</span>Retweets
          </div>
          <div class="px-2">
            <span class="text-black font-bold pr-1">{{ tweet!.replies_count }}</span>Replies
          </div>
          <div class="px-2">
            <span class="text-black font-bold pr-1">{{ tweet!.likes_count }}</span>Likes
          </div>
        </div>
        <mat-divider></mat-divider>
        <div class="py-1 text-gray-500 flex items-center">
          <div class="w-1/4 flex justify-around">
            <div (click)="openReplyDialog()"
                 class="group flex items-center w-min cursor-pointer hover:text-blue-500"
                 [ngClass]="{'text-blue-500' : tweet!.auth_replied}">
              <div class="group-hover:bg-blue-100/50 h-10 w-10 flex items-center justify-around rounded-full">
                <mat-icon *ngIf="tweet!.auth_replied; else defaultReplyIcon" class="text-xl -mt-1 -mr-1">chat_bubble</mat-icon>
                <ng-template #defaultReplyIcon>
                  <mat-icon class="text-xl -mt-1 -mr-1">chat_bubble_outline</mat-icon>
                </ng-template>
              </div>
            </div>
          </div>
          <div class="w-1/4 flex justify-around">
            <div (click)="tweet!.auth_retweet ? undoRetweet(tweet) : retweet(tweet)"
                 class="group flex items-center w-min cursor-pointer hover:text-green-500"
                 [ngClass]="{'text-green-500' : tweet!.auth_retweet}">
              <div class="group-hover:bg-green-200/40 h-10 w-10 flex items-center justify-around rounded-full">
                <mat-icon class="text-xl -mt-1 -mr-1">repeat</mat-icon>
              </div>
            </div>
          </div>
          <div class="w-1/4 flex justify-around">
            <div (click)="tweet!.auth_like ? unlikeTweet(tweet) : likeTweet(tweet)"
                 class="group flex items-center w-min cursor-pointer hover:text-red-500"
                 [ngClass]="{'text-red-500' : tweet!.auth_like}">
              <div class="group-hover:bg-red-100/50 h-10 w-10 flex items-center justify-around rounded-full">
                <mat-icon *ngIf="tweet!.auth_like; else defaultLikeIcon" class="text-xl -mt-1 -mr-1">favorite</mat-icon>
                <ng-template #defaultLikeIcon>
                  <mat-icon class="text-xl -mt-1 -mr-1">favorite_border</mat-icon>
                </ng-template>
              </div>
            </div>
          </div>
          <div class="w-1/4 flex justify-around">
            <div [matMenuTriggerFor]="shareMenu"
                 class="group flex items-center w-min cursor-pointer hover:text-blue-500">
              <div class="group-hover:bg-blue-100/50 h-10 w-10 flex items-center justify-around rounded-full">
                <mat-icon class="text-xl -mt-1 -mr-1">ios_share</mat-icon>
              </div>
            </div>
            <mat-menu #shareMenu="matMenu" class="w-52">
              <button mat-menu-item disabled>
                <mat-icon>bookmark_add</mat-icon>
                Bookmark
              </button>
              <button mat-menu-item [cdkCopyToClipboard]="getTweetUrl(tweet!)" (click)="openSnackbar()">
                <mat-icon>add_link</mat-icon>
                Copy link to Tweet
              </button>
            </mat-menu>
          </div>
        </div>
        <mat-divider></mat-divider>
      </div>
    </div>
  </div>

  <!-- The reply form -->
  <div class="my-3 mx-4">
    <app-tweet-create [repliesTo]="tweet" (tweetCreated)="appendReply($event)"></app-tweet-create>
  </div>
  <mat-divider></mat-divider>

  <!-- The tweet's replies -->
  <app-tweet *ngFor="let reply of tweet!.replies" [tweet]="reply"></app-tweet>

</div>

<div *ngIf="repliesTo && displayRepliesTo" class="grid grid-cols-10 gap-4">
  <div class="col-span-2 md:col-span-1 flex flex-col items-center">
    <div class="h-12 w-12">
      <img *ngIf="repliesTo.user!.avatar; else avatarPlaceholder"
           matListAvatar src="http://localhost:1111/images/user/{{ repliesTo.user!.id }}/{{ repliesTo.user!.avatar }}"
           alt="user avatar" class="object-cover h-full w-full rounded-full cursor-pointer">
      <ng-template #avatarPlaceholder>
        <div class="h-full w-full flex justify-around items-center bg-gray-200 rounded-full">
          <mat-icon class="text-gray-600" style="width: auto; height: auto">person_outline</mat-icon>
        </div>
      </ng-template>
    </div>
    <div class="h-10 grow my-2 border-r-2 border-gray-300"></div>
  </div>

  <div class="col-span-8 md:col-span-9">
    <div>
      <span class="font-bold pr-2 hover:underline">{{ repliesTo.user!.name }}</span>
      <span class="text-gray-500">@{{ repliesTo.user!.handle }} Â· {{ repliesTo!.created_at | date }}</span>
    </div>
    {{ repliesTo.content }}
    <div *ngIf="repliesTo.images?.length"
         class="mt-3 mb-7 flex h-40 rounded-3xl overflow-hidden"
         [ngClass]="{'flex-wrap' : repliesTo.images.length === 4}">
      <img *ngFor="let img of repliesTo.images" src="http://localhost:1111/{{ img.url }}"
           alt="tweet image" class="w-full object-cover border border-transparent"
           [ngClass]="{
                 'w-1/2' : repliesTo.images.length === 2,
                 'w-1/3' : repliesTo.images.length === 3,
                 'w-1/2 h-1/2' : repliesTo.images.length === 4
                 }">
    </div>
  </div>
</div>

<div class="grid grid-cols-10 gap-4">
  <div class="col-span-2 md:col-span-1 flex flex-col items-center">
    <div class="h-12 w-12">
      <img *ngIf="(authedUser$|async)!.avatar; else avatarPlaceholder" matListAvatar src="http://localhost:1111/images/user/{{ (authedUser$|async)!.id }}/{{ (authedUser$|async)!.avatar }}"
           alt="user avatar" class="object-cover h-full w-full rounded-full cursor-pointer">
      <ng-template #avatarPlaceholder>
        <div class="h-full w-full flex justify-around items-center bg-gray-200 rounded-full">
          <mat-icon class="text-gray-600" style="width: auto; height: auto">person_outline</mat-icon>
        </div>
      </ng-template>
    </div>
  </div>
  <div *ngIf="!loading, else showLoading" class="col-span-8 md:col-span-9 text-lg">
    <form [formGroup]="tweetForm" (ngSubmit)="createTweet(tweetForm.value)">
      <mat-form-field class="w-full">
          <textarea matInput [placeholder]="repliesTo ? 'Tweet your reply' : 'What\'s happening?'"
                    cdkTextareaAutosize cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5"
                    #content formControlName="content" maxlength="280">
          </textarea>
        <mat-hint>{{ content.value.length}} / 280</mat-hint>
      </mat-form-field>
      <div *ngIf="imagesPreview.length" class="grid grid-cols-2 gap-3 py-3 my-3 border-b border-gray-200">
        <div *ngFor="let img of imagesPreview, let i = index" class="relative h-36 rounded-3xl overflow-hidden">
          <img [src]="img" class="w-full object-center object-cover" alt="Tweet image">
          <div class="absolute top-1 left-1 rounded-full bg-gray-900 text-white">
            <button mat-icon-button (click)="removeImage(i)" type="button" aria-label="Remove image">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      </div>
      <div class="flex justify-between">
        <div>
          <input type="file" #fileInput (change)="makePreview(fileInput.files!)"
                 accept="image/png, image/jpeg" hidden multiple>
          <button mat-icon-button (click)="fileInput.click()" type="button"
                  color="primary" aria-label="Upload tweet images">
            <mat-icon>image</mat-icon>
          </button>
        </div>
        <button mat-flat-button color="primary" type="submit" [disabled]="!content.value.length">
          <span *ngIf="repliesTo; else defaultText">Reply</span>
          <ng-template #defaultText>Tweet</ng-template>
        </button>
      </div>
    </form>
  </div>
  <ng-template #showLoading>
    <div class="flex-grow flex justify-around py-5">
      <mat-spinner diameter="27" strokeWidth="3"></mat-spinner>
    </div>
  </ng-template>
</div>
